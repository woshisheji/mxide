171000程序集名备注10|41|2-3-4
170100掉落配置表

231000子程序名返回值类型异步公开备注10|10|4|4|241|2|3|4|5-6
230100掉落表加载读取 data/drop.Json 配置
Sql = 数据配置.加载掉落
ret = 数据库执行取ID(Sql, 1, 1)
let 数据对象 = 数据Json字符串到对象(ret)
!!如果(数据对象.errcode != 200)
返回(0)
""如果结束()
 // 初始化加载，要存到全局对象管理，用于下发给客户端的
系统配置.掉落配置 = 数据对象.data
服务端调试输出('掉落表数量:' + 系统配置.掉落配置.#长度)
 // 
let 配置 = 申明自定义(掉落表配置表)
配置.规则ID = 0
配置.物品ID = 0
配置.概率 = 0

231000子程序名返回值类型异步公开备注18|10|4|4|6|161|2|3|4|5-6
230100掉落表怪物死亡奖励数组型给全局主角背包掉落奖励
241100参数名类型备用可空初始值备注1|2|3|4|5|6
240000ID数值型掉落规则的ID
351100变量名类型备用备注8|6|4|41|2|3|4
350000奖励列表数组型
!!数组循环(系统配置.掉落配置, i)
let 掉落 = 申明自定义(掉落表配置表)
 // 
掉落 = 系统配置.掉落配置[i]
 // 判断掉落规则
!!如果(掉落.规则ID == ID)
 // 判断掉落概率
let 概率 = 取随机数(1, 10000)
 // 如果满足掉落条件则给与玩家物品
let 百分比 = 掉落.概率
!!如果(概率 <= 百分比)
数组加入成员末尾(奖励列表, 掉落.物品ID)
""如果结束()
""如果结束()
""数组循环结束()
 // 批量推送给客户端
返回(奖励列表)


